# ARM Project – GAP (Group 13)

## Team Members
- Sanghyeon PARK (ropopau)
- Valentin GIBBE

## Achieved Milestones
### Basic Milestones
- [X] Milestone 0 – Environment setup  
- [X] Milestone 1 – Control console  
- [X] Milestone 2 – UART logging  
- [X] Milestone 3 – Gyroscope support  

### Additional Milestones
- [X] Milestone A – Software version storage  
- [X] Milestone B – Mr. Clean  
- [X] Milestone C – Self-test **(except gyroscope)**  
- [X] Milestone D – Overflowing bucket  
- [X] Milestone E – Sleep mode **(partially)**  
- [ ] Milestone F – Turn signals  
- [ ] Milestone G – Developer guide  

## Technical Description

**Stm32cubeIDE Version:** 6.14.1  
**Board:** Nucleo stm32f401ret6

### Implementation Details

The GAP system uses the functions provided by the **libgapcom** library.

- Request reception and parsing are handled in a state machine defined in the file `gapcom_fsm.c`. There is the `FSM_HEADER` state that reads the header (SOF, ID, LEN, TYPE, HEAD_CRC), followed by the `FSM_PAYLOAD` state which reads the proto-message.

- Callbacks (all the logic that allows the system to respond to requests) are installed via Gapcom. Gapcom also ensures that the correct callback is called when the corresponding request is received.

- The version is stored in the `.version` memory section defined in the file `STM32F401RETX_FLASH.ld`. It is located at the very end of the usable flash memory, with a size of 16 bytes. The `NOLOAD` keyword prevents this memory section from being loaded and overwritten every time the board is flashed.

### Trade-offs and Limitations

- Some WARNINGs may appear in the files generated by the IDE. However, there are no warnings in the files we wrote ourselves.

- The Nucleo board has some limitations compared to the other board. It does not have UART7, so we used UART6 for the control console. The same applies to the LEDs: only one is available and usable.

- Versioning follows the **SemVer** syntax, but only in the format: **Major.Minor.Patch**. Optional metadata is not handled (for now).

- **Sleep mode does not reduce the Sysclock**. Also, UART deactivation (`uart.c`) is currently commented out because it can sometimes break the system.

- Callbacks run in an interrupt context, including for the self-test. However, the gyroscope self-test requires a `HAL_Delay` (which cannot be used in an interrupt context). This is why it could not be implemented.
